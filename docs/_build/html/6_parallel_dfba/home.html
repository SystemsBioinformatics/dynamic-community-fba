<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>6. Dynamic Parallel FBA &mdash; dynamic-community-fba  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. EndPointFBA" href="../7_endpoint_fba/home.html" />
    <link rel="prev" title="5. Dynamic Joint FBA" href="../5_djoint/home.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            dynamic-community-fba
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../1_installation/home.html">1. Installation and Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_getting_started/home.html">2. CBMPy Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_DynamicFBA/home.html">3. Dynamic FBA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_community_matrix/home.html">4. The community model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5_djoint/home.html">5. Dynamic Joint FBA</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. Dynamic Parallel FBA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../7_endpoint_fba/home.html">7. EndPointFBA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_Advanced/home.html">7. Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../9_faq/home.html">8. FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10_API/DCFBA.html">9. API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">dynamic-community-fba</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">6. Dynamic Parallel FBA</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/6_parallel_dfba/home.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dynamic-parallel-fba">
<h1>6. Dynamic Parallel FBA<a class="headerlink" href="#dynamic-parallel-fba" title="Permalink to this heading"></a></h1>
<p>The second method to model microbial interactions available through this package is Dynamic Parallel FBA (dpFBA).
The key idea is to perform FBA on individual models while keeping track of the <em>pool</em> or <em>medium</em> of external metabolites from which all models can take up nutrients.
Again we keep track of the overall concentrations of biomass and external metabolites and update this using the set time interval.</p>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading"></a></h2>
<p>To run a simulation with Dynamic Parallel FBA, you first need to define your <code class="docutils literal notranslate"><span class="pre">ParallelDynamicFBA</span></code> model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">cbmpy.CBModel</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">dcFBA</span> <span class="kn">import</span> <span class="n">DefaultModels</span>
<span class="kn">from</span> <span class="nn">dcFBA.DynamicModels</span> <span class="kn">import</span> <span class="n">DynamicParallelFBA</span>

<span class="n">model1</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">DefaultModels</span><span class="o">.</span><span class="n">read_default_model</span><span class="p">(</span><span class="s2">&quot;e_coli_core&quot;</span><span class="p">)</span>
<span class="n">model2</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">DefaultModels</span><span class="o">.</span><span class="n">read_default_model</span><span class="p">(</span><span class="s2">&quot;strep_therm&quot;</span><span class="p">)</span>

<span class="c1"># Exchange reaction are not set correctly, here we fix this</span>
<span class="k">for</span> <span class="n">rid</span> <span class="ow">in</span> <span class="n">model1</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">rid</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;R_EX&quot;</span><span class="p">):</span>
        <span class="n">reaction</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
        <span class="n">reaction</span><span class="o">.</span><span class="n">is_exchange</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">for</span> <span class="n">rid</span> <span class="ow">in</span> <span class="n">model2</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">rid</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;R_EX&quot;</span><span class="p">):</span>
        <span class="n">reaction</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
        <span class="n">reaction</span><span class="o">.</span><span class="n">is_exchange</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Give the two models different glucose uptake rates</span>
<span class="n">model1</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="s2">&quot;R_GLCpts&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setUpperBound</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">model2</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="s2">&quot;R_GLCpts&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setUpperBound</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="c1"># Restrict Lactose uptake</span>
<span class="n">model2</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="s2">&quot;R_LCTSGALex&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLowerBound</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">model2</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="s2">&quot;R_LCTSt6&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setUpperBound</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">DynamicParallelFBA</span></code> class accepts a list of N models. In this example, we use two models as described before.</p>
<p>Next, we specify the initial concentrations of both models and the initial concentrations of the external species.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parallel_fba</span> <span class="o">=</span> <span class="n">DynamicParallelFBA</span><span class="p">(</span>
    <span class="p">[</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">{</span>
        <span class="s2">&quot;M_glc__D_e&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s2">&quot;M_succ_e&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;M_glu__L_e&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;M_gln__L_e&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;M_lcts_e&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span> <span class="c1">#Build DynamicParallelFBA model</span>
</pre></div>
</div>
<p>To run the simulation, use the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parallel_fba</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">simulate</span></code> runs the dynamic analysis until no organism can grow or one of the solutions is infeasible. Again we store
the intermediate results for biomasses, metabolites and fluxes in the model and can retrieve them once the simulation is done:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">biomasses</span> <span class="o">=</span> <span class="n">parallel_fba</span><span class="o">.</span><span class="n">get_biomasses</span><span class="p">()</span>
<span class="n">metabolites</span> <span class="o">=</span> <span class="n">parallel_fba</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">parallel_fba</span><span class="o">.</span><span class="n">get_time_points</span><span class="p">()</span>
<span class="n">fluxes</span> <span class="o">=</span> <span class="n">parallel_fba</span><span class="o">.</span><span class="n">fluxes</span>
</pre></div>
</div>
<p>Using simple plotting functions from <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code>, you can visualize the results easily:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">metabolites</span><span class="p">[</span><span class="s2">&quot;M_glc__D_e&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;[Glucose]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">metabolites</span><span class="p">[</span><span class="s2">&quot;M_lcts_e&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;[Lactose]&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Concentration&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/ParallelFBA2_metabolites.png"><img alt="Metabolite concentrations" class="align-center" src="../_images/ParallelFBA2_metabolites.png" style="width: 500px;" /></a>
<p>Alternatively, you can plot the biomasses over time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Plot biomasses</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">biomasses</span><span class="p">[</span><span class="n">model1</span><span class="o">.</span><span class="n">getId</span><span class="p">()],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ecoli&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">biomasses</span><span class="p">[</span><span class="n">model2</span><span class="o">.</span><span class="n">getId</span><span class="p">()],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;strep&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Concentration&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/ParallelFBA2_Biomass_concentrations.png"><img alt="Biomass concentrations" class="align-center" src="../_images/ParallelFBA2_Biomass_concentrations.png" style="width: 500px;" /></a>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../5_djoint/home.html" class="btn btn-neutral float-left" title="5. Dynamic Joint FBA" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../7_endpoint_fba/home.html" class="btn btn-neutral float-right" title="7. EndPointFBA" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, S.C.M.A. Wijnen, F. Moro.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>